<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Card</title>
    <link rel="apple-touch-icon" sizes="180x180" href="favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="512x512" href="favicon_io/android-chrome-512x512.png">
    <link rel="icon" type="image/png" sizes="192x192" href="favicon_io/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon_io/favicon-16x16.png">
    <link rel="manifest" href="favicon_io/site.webmanifest">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet" />
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: 0;
            background-color: #e0d4f7;
            font-family: 'Nunito', sans-serif;
            height: 98vh;
            padding-top: 40px;
            position: relative;
            /* Ensure body takes full height */
            min-height: 98vh;
        }

        @media (min-width: 1024px) {
            body{
                height: 90vh;
                min-height:90vh ;
            }
            .custom-height {
                height: 145vh;
                min-height: 145vh;
            }
        }

        .content {
            flex: 1;
            /* Allow the content area to grow and take available space */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .loader {
            display: none;
            position: relative;
            height: 32px;
            width: 150px;
            box-sizing: border-box;
            overflow: hidden;
            border: 2px solid #FFF;
            border-radius: 20px;
        }

        .loader:before {
            content: '';
            position: absolute;
            left: 0;
            bottom: 2px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #3b3b98;
            animation: ballbns 3s ease-in-out infinite;
        }

        @keyframes ballbns {
            0% {
                left: 0;
                transform: translateX(0%);
                box-shadow:
                    -5px 0 0 -1px rgba(59, 59, 152, 0.9),
                    -10px 0 0 -2px rgba(59, 59, 152, 0.8),
                    -15px 0 0 -4px rgba(59, 59, 152, 0.6),
                    -20px 0 0 -6px rgba(59, 59, 152, 0.4),
                    -25px 0 0 -8px rgba(59, 59, 152, 0.2);
            }

            49% {
                left: 100%;
                transform: translateX(-100%);
                box-shadow:
                    -5px 0 0 -1px rgba(59, 59, 152, 0.9),
                    -10px 0 0 -2px rgba(59, 59, 152, 0.8),
                    -15px 0 0 -4px rgba(59, 59, 152, 0.6),
                    -20px 0 0 -6px rgba(59, 59, 152, 0.4),
                    -25px 0 0 -8px rgba(59, 59, 152, 0.2);
            }

            51% {
                left: 100%;
                transform: translateX(-100%);
                box-shadow:
                    5px 0 0 -1px rgba(59, 59, 152, 0.9),
                    10px 0 0 -2px rgba(59, 59, 152, 0.8),
                    15px 0 0 -4px rgba(59, 59, 152, 0.6),
                    20px 0 0 -6px rgba(59, 59, 152, 0.4),
                    25px 0 0 -8px rgba(59, 59, 152, 0.2);
            }

            100% {
                left: 0;
                transform: translateX(0%);
                box-shadow:
                    5px 0 0 -1px rgba(59, 59, 152, 0.9),
                    10px 0 0 -2px rgba(59, 59, 152, 0.8),
                    15px 0 0 -4px rgba(59, 59, 152, 0.6),
                    20px 0 0 -6px rgba(59, 59, 152, 0.4),
                    25px 0 0 -8px rgba(59, 59, 152, 0.2);
            }
        }

        .card {
            background-color: #fff;
            border-radius: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            text-align: center;
            width: 300px;
            position: relative;
            margin: 20px 0;
        }

        .card img {
            border-radius: 50%;
            width: 100px;
            height: 100px;
            object-fit: cover;
            border: 5px solid #fff;
            margin-top: -50px;
        }

        .card h2 {
            font-size: 24px;
            margin: 10px 0 5px;
            color: #333;
        }

        .card h3 {
            font-size: 18px;
            margin: 5px 0;
            color: #777;
        }

        .card p {
            font-size: 14px;
            color: #555;
            margin: 10px 0 20px;
        }

        .card .contact {
            display: inline-block;
            background-color: #3b3b98;
            color: #fff;
            padding: 10px 20px;
            border-radius: 20px;
            text-decoration: none;
            font-size: 14px;
        }

        .card .logo {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: #3b3b98;
            color: #fff;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
        }

        .card .button {
            display: inline-block;
            background-color: #3b3b98;
            color: #fff;
            padding: 10px 20px;
            border-radius: 20px;
            text-decoration: none;
            font-size: 14px;
            margin-top: 20px;
        }

        .card .qrcode {
            width: 200px;
            height: 200px;
            margin-top: 8px;
        }

        .card .input-field {
            width: 80%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 20px;
            font-size: 14px;
        }

        footer {
            text-align: center;
            margin-top: 20px;
            font-size: 12px;
            color: #3b3b98;
            background-color: #f9f9f9;
            border-top: 1px solid #ddd;
            padding: 10px;
            border-radius: 0 0 20px 20px;
            width: 100%;
            /* Ensure footer takes full width */
        }
    </style>
</head>

<body>
    <div class="content">
        <span class="loader" id="loader"></span>

        <div class="card" id="card-id-input">
            <h2>Enter Your ID</h2>
            <input class="input-field" id="input-id" type="text" placeholder="Enter your ID" />
            <a class="button" id="submit-button" href="#">Enter</a>
            <div class="error" id="error"></div>
        </div>

        <div class="card" id="card-1" style="display: none;">
            <div class="logo" id="logo-initials">HB</div>
            <img id="profile-pic"
                src="https://storage.googleapis.com/a1aa/image/RhZkkateAqVKeEcK7GUjdRT48URHebElilzGv9xRDkvMxGVnA.jpg"
                alt="Profile Picture" />
            <h2 id="profile-name">Harshil Chovatiya</h2>
            <h3 id="member_id_1">Id: 1</h3>
            <p id="profile_address">Surat Gujrat</p>
            <a class="button contact" id="phone_number" href="">+1234567890</a>
        </div>

        <div class="card" id="card-2" style="display: none;">
            <h2>QR Code Card</h2>
            <a class="button" id="downloadButton" href="#" onclick="downloadQRCode()">Download Code</a>
            <img id="qrCodeImage" class="qrcode" src="" alt="QR Code" />
            <h3>Scan Me</h3>
        </div>
    </div>

    <footer>
        <p style="margin: 0;">&copy; 2024 Developed by Harshil Chovatiya</p>
    </footer>

    <script>
        async function fetchUserDetails() {
            const memberId = document.getElementById('input-id').value;
            document.getElementById('error').style.display = 'none';
            document.getElementById('loader').style.display = 'block';
            document.getElementById('card-id-input').style.display = 'none';

            try {
                const response = await fetch('https://flask-api-gray-ten.vercel.app/userdetails', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ member_id: memberId })
                });

                if (!response.ok) throw new Error('Failed to fetch user details');

                const data = await response.json();

                // Populate the profile card
                const userName = data.user.name;

                // Extract the first two words
                const nameParts = userName.split(' ').slice(0, 2);

                // Get the first letters and convert to uppercase
                const initials = nameParts.map(part => part.charAt(0).toUpperCase()).join('');

                // Store the initials (e.g., "JR" for "Joeylene Rivera")
                const initialsVariable = initials;

                // Set the profile name and initials in the appropriate elements
                document.getElementById('profile-name').textContent = userName;
                document.getElementById('logo-initials').textContent = initialsVariable;
                document.getElementById('profile-pic').src = data.user.profile_pic ?? "1.jpg";
                document.getElementById('member_id_1').textContent = `Id: ${data.user.member_id}`;
                document.getElementById('profile_address').textContent = data.user.address;
                document.getElementById('phone_number').textContent = data.user.phone_number;
                document.getElementById('qrCodeImage').src = data.qr_code;

                // Hide ID input card and show the details and QR code cards
                document.getElementById('card-id-input').style.display = 'none';
                document.getElementById('card-1').style.display = 'block';
                document.getElementById('card-2').style.display = 'block';
                document.body.classList.add('custom-height');
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('error').innerText = 'User not found or an error occurred';
                document.getElementById('error').style.display = 'block';
                document.getElementById('card-id-input').style.display = 'block';
            } finally {
                document.getElementById('loader').style.display = 'none'; // Hide the loader
            }
        }

        document.getElementById('submit-button').addEventListener('click', (event) => {
            event.preventDefault(); // Prevent default link behavior
            fetchUserDetails();
        });

        async function downloadQRCode() {
            const qrCodeImage = document.getElementById('qrCodeImage').src;
            try {
                const response = await fetch(qrCodeImage);
                if (!response.ok) throw new Error('Failed to download QR code');

                const blob = await response.blob();
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = 'qrcode.png';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch (error) {
                console.error('Error downloading QR code:', error);
            }
        }
    </script>
</body>

</html>